

<!doctype html>
    <html lang="en-US" id="template-archives" class="base">
        <head>
        
        <script defer data-domain="context.center" src="https://plausible.io/js/plausible.js"></script>
        <link rel="alternate" type="application/rss+xml" title="Context Center RSS" href="https://context.center/rss/" />
    	<link rel="alternate" type="application/atom+xml" title="Context Center Feed" href="https://context.center/feed/" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Attribution reporting  |  Android Developers</title>
        <link rel="original" http-equiv href="https://developer.android.com/design-for-safety/ads/attribution" />
        
            
                <!-- <link rel="stylesheet" href="https://context.center/assets/css/template-archives.css?v=2109509706" /> -->
                <link rel="stylesheet" href="https://context.center/assets/css/template-archives.css?v=2109509706" id=""></link>

            
        
        
            <link rel="canonical" href="https://developer.android.com/design-for-safety/ads/attribution" />
            

            <meta property="og:title"
                content="Attribution reporting | Android Developers">

            <meta property="og:description"
                content="Provide feedback">


            <meta property="og:url"
                content="https://developer.android.com/design-for-safety/ads/attribution" />

            <meta property="og:site_name" content="Context Center" />

            <meta property="og:locale" content="en_US" />

            <meta name="twitter:site" content="@chronotope" />

            <meta name="twitter:description" content="Provide feedback" />

            <!-- I prefer the summary_large_image Twitter card for posts. -->
            <meta name="twitter:card" content="summary_large_image" />
            <!-- You, you're the creator. -->
            <meta name="twitter:creator" content="@chronotope" />
            <!-- This property is for the article title, not site title. -->
            <meta name="twitter:title" content="Attribution reporting | Android Developers" />

            

            <meta property="og:type" content="website" />

            <script type="application/ld+json">
                {
                    "@context": "http://schema.org",
                    "@type": "WebPage",
                    "url": "https://developer.android.com/design-for-safety/ads/attribution",
                    "headline": "Attribution reporting  |  Android Developers",
                    "about": "Provide feedback",

                    "image": [
                        
                        
                    ],
                    "isAccessibleForFree": "True",
                    "isPartOf": {
                        "@type": ["CreativeWork", "Product"],
                        "name": "Fight With Tools",
                        "productID": "fightwithtools.dev"
                    },
                    "license": "http://creativecommons.org/licenses/by-sa/4.0/",
                    "archivedAt": "https://context.center/timegate/https:/developer.android.com/design-for-safety/ads/attribution/",
                    "sameAs": "https://developer.android.com/design-for-safety/ads/attribution",
                }
            </script>


        
        
        </head>
        <body >
            <div class="wrapper">
                <header>
                    <div class="left">
                        <h1>Archived: Attribution reporting  |  Android Developers</h1>
                        <p>This is a simplified archive of the page at <a href="https://developer.android.com/design-for-safety/ads/attribution" target="_blank">https://developer.android.com/design-for-safety/ads/attribution</a></p>
                    </div>

                            <div id="share-embed">
                                <span>Use this page embed on your own site:</span>
                                <textarea id="html-embed" name="story" rows="8" cols="40">
                                    <script>window.contexterSetup=window.contexterSetup||function(){window.contexterSetupComplete=!0;class ContexterLink extends HTMLAnchorElement{constructor(){super()}connectedCallback(){this.setAttribute("target","_blank")}}customElements.define("contexter-link",ContexterLink,{extends:"a"}),customElements.define("contexter-inner",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__inner"}}),customElements.define("contexter-thumbnail",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__thumbnail"}}),customElements.define("contexter-byline",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__byline"}}),customElements.define("contexter-keywordset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__keywordset"}}),customElements.define("contexter-linkset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__linkset"}}),customElements.define("contexter-meta",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__meta"}}),customElements.define("contexter-summary",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="p-summary entry-summary"}}),customElements.define("contexter-box-head",class extends HTMLElement{constructor(){super()}connectedCallback(){this.className="contexter-box__head"}}),customElements.define("contexter-box-inner",class extends HTMLElement{constructor(){super()}connectedCallback(){}});class ContexterBox extends HTMLElement{constructor(){super(),this.first=!0,this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){if(this.first){this.first=!1;var style=document.createElement("style"),lightDomStyle=(style.innerHTML=`:host {--background: #f5f6f7;--border: darkblue;--blue: #0000ee;--font-color: black;--inner-border: black;font-family: Franklin,Arial,Helvetica,sans-serif;font-size: 14px;background: var(--background);width: 600px;color: var(--font-color);min-height: 90px;display: block;padding: 8px;border: 1px solid var(--border);cursor: pointer;box-sizing: border-box;margin: 6px;contain: content;margin: 6px auto;}// can only select top-level nodes with slotted::slotted(*) {max-width: 100%;display:block;}::slotted([slot=thumbnail]) {max-width: 100%;display:block;}::slotted([slot=header]) {width: 100%;font-size: 1.25rem;font-weight: bold;display:block;margin-bottom: 6px;}::slotted([slot=author]) {max-width: 50%;font-size: 12px;display:inline-block;float: left;}::slotted([slot=time]) {max-width: 50%;font-size: 12px;display:inline-block;float: right;}::slotted([slot=summary]) {width: 100%;margin-top: 6px;padding: 10px 2px;border-top: 1px solid var(--inner-border);font-size: 15px;display:inline-block;margin-bottom: 6px;}contexter-meta {height: auto;margin-bottom: 4px;width: 100%;display: grid;position: relative;min-height: 16px;grid-template-columns: repeat(2, 1fr);}::slotted([slot=keywords]) {width: 80%;padding: 2px 4px;border-top: 1px solid var(--inner-border);font-size: 11px;display: block;float: right;font-style: italic;text-align: right;grid-column: 2/2;grid-row: 1;align-self: end;justify-self: end;}::slotted([slot=keywords]):empty {border-top: 0px solid var(--inner-border);}::slotted([slot=archive-link]) {font-size: 1em;display: inline;}::slotted([slot=archive-link])::after {content: "|";display: inline;color: var(--font-color);text-decoration: none;margin: 0 .5em;}::slotted([slot=read-link]) {font-size: 1em;display: inline;}contexter-linkset {width: 80%;padding: 2px 4px;font-size: 13px;float: left;font-weight: bold;grid-row: 1;grid-column: 1/2;align-self: end;justify-self: start;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {:host {width: 310px;}}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){:host {--background: #354150;--border: #1f2b37;--blue: #55b0ff;--font-color: #ffffff;--inner-border: #787a7c;background: var(--background);border: 1px solid var(--border)}}`,document.createElement("style"));lightDomStyle.innerHTML=`contexter-box {contain: content;}contexter-box .read-link {font-weight: bold;}contexter-box a {color: #0000ee;}contexter-box img {width: 100%;border: 0;padding: 0;margin: 0;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {...}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){contexter-box a {color: #55b0ff;}}`,this.appendChild(lightDomStyle),this.shadow.appendChild(style);const innerContainer=document.createElement("contexter-box-inner"),innerSlotThumbnail=(this.shadow.appendChild(innerContainer),document.createElement("slot")),innerSlotHeader=(innerSlotThumbnail.name="thumbnail",innerContainer.appendChild(innerSlotThumbnail),document.createElement("slot")),innerSlotAuthor=(innerSlotHeader.name="header",innerContainer.appendChild(innerSlotHeader),document.createElement("slot")),innerSlotTime=(innerSlotAuthor.name="author",innerContainer.appendChild(innerSlotAuthor),document.createElement("slot")),innerSlotSummary=(innerSlotTime.name="time",innerContainer.appendChild(innerSlotTime),document.createElement("slot")),metaContainer=(innerSlotSummary.name="summary",innerContainer.appendChild(innerSlotSummary),document.createElement("contexter-meta")),innerSlotInfo=(innerContainer.appendChild(metaContainer),document.createElement("slot")),linkContainer=(innerSlotInfo.name="keywords",metaContainer.appendChild(innerSlotInfo),document.createElement("contexter-linkset")),innerSlotArchiveLink=(metaContainer.appendChild(linkContainer),document.createElement("slot")),innerSlotReadLink=(innerSlotArchiveLink.name="archive-link",linkContainer.appendChild(innerSlotArchiveLink),document.createElement("slot"));innerSlotReadLink.name="read-link",linkContainer.appendChild(innerSlotReadLink),this.className="contexter-box",this.onclick=e=>{if(!e.target.className.includes("read-link")&&!e.target.className.includes("title-link")){const mainLinks=this.querySelectorAll("a.main-link");mainLinks[0].click()}}}}}customElements.define("contexter-box",ContexterBox)},window.contexterSetupComplete||window.contexterSetup();</script><contexter-box class="link-card h-entry hentry" itemscope="" itemtype="https://schema.org/CreativeWork"><contexter-thumbnail class="thumbnail" slot="thumbnail"></contexter-thumbnail><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><a is="contexter-link" href="https://developer.android.com/design-for-safety/ads/attribution" itemprop="url">Attribution reporting  |  Android Developers</a></contexter-box-head></contexter-box-head><time class="dt-published published" slot="time" itemprop="datePublished" datetime="2022-04-07T13:51:40.137Z">3/7/2022</time><contexter-summary class="p-summary entry-summary" itemprop="abstract" slot="summary"><p>Provide feedback</p></contexter-summary><contexter-keywordset itemprop="keywords" slot="keywords"></contexter-keywordset><a href="https://web.archive.org/web/20220407135144/https://developer.android.com/design-for-safety/ads/attribution" is="contexter-link" target="_blank" rel="timemap" class="read-link archive-link" itemprop="archivedAt" slot="archive-link">Archived</a><a is="contexter-link" href="https://developer.android.com/design-for-safety/ads/attribution" class="read-link main-link" itemprop="sameAs" slot="read-link">Read</a></contexter-box>
                                </textarea><br />
                                <button onclick="(function(e){ navigator.clipboard.writeText(document.getElementById('html-embed').value); })()">Copy</button>
                            </div>
                            
                            <script>window.contexterSetup=window.contexterSetup||function(){window.contexterSetupComplete=!0;class ContexterLink extends HTMLAnchorElement{constructor(){super()}connectedCallback(){this.setAttribute("target","_blank")}}customElements.define("contexter-link",ContexterLink,{extends:"a"}),customElements.define("contexter-inner",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__inner"}}),customElements.define("contexter-thumbnail",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__thumbnail"}}),customElements.define("contexter-byline",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__byline"}}),customElements.define("contexter-keywordset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__keywordset"}}),customElements.define("contexter-linkset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__linkset"}}),customElements.define("contexter-meta",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__meta"}}),customElements.define("contexter-summary",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="p-summary entry-summary"}}),customElements.define("contexter-box-head",class extends HTMLElement{constructor(){super()}connectedCallback(){this.className="contexter-box__head"}}),customElements.define("contexter-box-inner",class extends HTMLElement{constructor(){super()}connectedCallback(){}});class ContexterBox extends HTMLElement{constructor(){super(),this.first=!0,this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){if(this.first){this.first=!1;var style=document.createElement("style"),lightDomStyle=(style.innerHTML=`:host {--background: #f5f6f7;--border: darkblue;--blue: #0000ee;--font-color: black;--inner-border: black;font-family: Franklin,Arial,Helvetica,sans-serif;font-size: 14px;background: var(--background);width: 600px;color: var(--font-color);min-height: 90px;display: block;padding: 8px;border: 1px solid var(--border);cursor: pointer;box-sizing: border-box;margin: 6px;contain: content;margin: 6px auto;}// can only select top-level nodes with slotted::slotted(*) {max-width: 100%;display:block;}::slotted([slot=thumbnail]) {max-width: 100%;display:block;}::slotted([slot=header]) {width: 100%;font-size: 1.25rem;font-weight: bold;display:block;margin-bottom: 6px;}::slotted([slot=author]) {max-width: 50%;font-size: 12px;display:inline-block;float: left;}::slotted([slot=time]) {max-width: 50%;font-size: 12px;display:inline-block;float: right;}::slotted([slot=summary]) {width: 100%;margin-top: 6px;padding: 10px 2px;border-top: 1px solid var(--inner-border);font-size: 15px;display:inline-block;margin-bottom: 6px;}contexter-meta {height: auto;margin-bottom: 4px;width: 100%;display: grid;position: relative;min-height: 16px;grid-template-columns: repeat(2, 1fr);}::slotted([slot=keywords]) {width: 80%;padding: 2px 4px;border-top: 1px solid var(--inner-border);font-size: 11px;display: block;float: right;font-style: italic;text-align: right;grid-column: 2/2;grid-row: 1;align-self: end;justify-self: end;}::slotted([slot=keywords]):empty {border-top: 0px solid var(--inner-border);}::slotted([slot=archive-link]) {font-size: 1em;display: inline;}::slotted([slot=archive-link])::after {content: "|";display: inline;color: var(--font-color);text-decoration: none;margin: 0 .5em;}::slotted([slot=read-link]) {font-size: 1em;display: inline;}contexter-linkset {width: 80%;padding: 2px 4px;font-size: 13px;float: left;font-weight: bold;grid-row: 1;grid-column: 1/2;align-self: end;justify-self: start;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {:host {width: 310px;}}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){:host {--background: #354150;--border: #1f2b37;--blue: #55b0ff;--font-color: #ffffff;--inner-border: #787a7c;background: var(--background);border: 1px solid var(--border)}}`,document.createElement("style"));lightDomStyle.innerHTML=`contexter-box {contain: content;}contexter-box .read-link {font-weight: bold;}contexter-box a {color: #0000ee;}contexter-box img {width: 100%;border: 0;padding: 0;margin: 0;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {...}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){contexter-box a {color: #55b0ff;}}`,this.appendChild(lightDomStyle),this.shadow.appendChild(style);const innerContainer=document.createElement("contexter-box-inner"),innerSlotThumbnail=(this.shadow.appendChild(innerContainer),document.createElement("slot")),innerSlotHeader=(innerSlotThumbnail.name="thumbnail",innerContainer.appendChild(innerSlotThumbnail),document.createElement("slot")),innerSlotAuthor=(innerSlotHeader.name="header",innerContainer.appendChild(innerSlotHeader),document.createElement("slot")),innerSlotTime=(innerSlotAuthor.name="author",innerContainer.appendChild(innerSlotAuthor),document.createElement("slot")),innerSlotSummary=(innerSlotTime.name="time",innerContainer.appendChild(innerSlotTime),document.createElement("slot")),metaContainer=(innerSlotSummary.name="summary",innerContainer.appendChild(innerSlotSummary),document.createElement("contexter-meta")),innerSlotInfo=(innerContainer.appendChild(metaContainer),document.createElement("slot")),linkContainer=(innerSlotInfo.name="keywords",metaContainer.appendChild(innerSlotInfo),document.createElement("contexter-linkset")),innerSlotArchiveLink=(metaContainer.appendChild(linkContainer),document.createElement("slot")),innerSlotReadLink=(innerSlotArchiveLink.name="archive-link",linkContainer.appendChild(innerSlotArchiveLink),document.createElement("slot"));innerSlotReadLink.name="read-link",linkContainer.appendChild(innerSlotReadLink),this.className="contexter-box",this.onclick=e=>{if(!e.target.className.includes("read-link")&&!e.target.className.includes("title-link")){const mainLinks=this.querySelectorAll("a.main-link");mainLinks[0].click()}}}}}customElements.define("contexter-box",ContexterBox)},window.contexterSetupComplete||window.contexterSetup();</script><contexter-box class="link-card h-entry hentry" itemscope="" itemtype="https://schema.org/CreativeWork"><contexter-thumbnail class="thumbnail" slot="thumbnail"></contexter-thumbnail><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><a is="contexter-link" href="https://developer.android.com/design-for-safety/ads/attribution" itemprop="url">Attribution reporting  |  Android Developers</a></contexter-box-head></contexter-box-head><time class="dt-published published" slot="time" itemprop="datePublished" datetime="2022-04-07T13:51:40.137Z">3/7/2022</time><contexter-summary class="p-summary entry-summary" itemprop="abstract" slot="summary"><p>Provide feedback</p></contexter-summary><contexter-keywordset itemprop="keywords" slot="keywords"></contexter-keywordset><a href="https://web.archive.org/web/20220407135144/https://developer.android.com/design-for-safety/ads/attribution" is="contexter-link" target="_blank" rel="timemap" class="read-link archive-link" itemprop="archivedAt" slot="archive-link">Archived</a><a is="contexter-link" href="https://developer.android.com/design-for-safety/ads/attribution" class="read-link main-link" itemprop="sameAs" slot="read-link">Read</a></contexter-box>
                            


                </header>
                <main>
                
                    <div id="readability-page-1" class="page"><div>

    
      






<p>
  <a href="https://issuetracker.google.com/issues/new?component=1116743&amp;template=1642601">Provide feedback</a>
</p>

<p>Today, it's common for mobile attribution and measurement solutions to use
cross-party identifiers, such as Advertising ID. The Attribution Reporting API
is designed to provide improved user privacy by removing reliance on cross-party
user identifiers, and to support key use cases for attribution and conversion
measurement across apps and the web.</p>

<p>This API has the following structural mechanisms that offer a
framework for improving privacy, which later sections in this document describe
in more detail:</p>

<ul>
<li>Limits the number of bits available for
<a href="#event-level-reports">event-level reports</a></li>
<li>Enables higher-fidelity conversion data only in
<a href="#aggregatable-reports">aggregatable reports</a></li>
<li>Introduces
<a href="#limits-available-triggers">rate limits for available triggers (conversions)</a>
and the
<a href="#limits-ad-tech-platforms-per-attribution-source">number of ad tech platforms that can be associated with a single attribution
source</a></li>
<li>Incorporates various noise adding techniques</li>
</ul>

<p>The preceding mechanisms limit the ability to link user identity across two
different apps or domains.</p>

<p>The Attribution Reporting API supports the following use cases:</p>

<ul>
<li><strong>Conversion reporting:</strong> Help advertisers measure the performance of their
campaigns by showing them conversion (trigger) counts and conversion (trigger)
values across various dimensions, such as by campaign, ad group, and ad creative.</li>
<li><strong>Optimization:</strong> Provide event-level reports that support optimization of ad
spend, by providing per-impression attribution data that can be used to train ML
models.</li>
<li><strong>Invalid activity detection:</strong> Provide reports that can be used in invalid
traffic and ad fraud detection and analysis.</li>
</ul>

<p>At a high level, the Attribution Reporting API works as follows, which later
sections of this document describe in more detail:</p>

<ol>
<li>The ad tech platform
<a href="#enroll-ad-tech-platform">completes an enrollment process</a> to use the
Attribution Reporting API.</li>
<li>The ad tech platform
<a href="#register-attribution-source">registers attribution sources</a>—ad clicks or
views—with the Attribution Reporting API.</li>
<li>The ad tech platform <a href="#register-trigger">registers triggers</a>—user conversions
on the advertiser app or website—with the Attribution Reporting API.</li>
<li>The Attribution Reporting API matches triggers to attribution sources—a
conversion attribution—and one or more triggers are sent off-device through
<a href="#event-level-reports">event-level</a> and <a href="#aggregatable-reports">aggregatable</a>
reports to ad tech platforms.</li>
</ol>



<p>To access the Attribution Reporting API and to ensure that privacy
mechanisms work as intended, all ad tech platforms (including Google's) need to
complete a lightweight enrollment process. The details of this process are still
in development, and we welcome your feedback.</p>

<p>The enrollment process ensures that ad tech platforms don't unnecessarily
duplicate themselves to gain more information about a user's site and app
activities. For example, the Attribution Reporting API limits the amount of
tracking and information an ad tech platform can view for a given attribution
source and trigger. More details on these limits appear in the section on
<a href="#view-measurement-data">viewing measurement data in attribution reports</a> later
in this document.</p>

<p>Businesses may register multiple times if there is a legitimate business need
(such as operating multiple independent product lines), and they do not combine
data from their multiple enrollments to bypass privacy restrictions.</p>

<p>During the enrollment process, ad tech platforms provide information such as the
following:</p>

<ul>
<li>Contact and business information</li>
<li>Postback URLs used for registering attribution sources, trigger attribution
and receiving event-level and aggregatable reports</li>
<li>Attribution Reporting API use cases</li>
</ul>

<h2 id="register-attribution-source" data-text="Register an attribution source (click or view)">Register an attribution source (click or view)</h2>

<p>The Attribution Reporting API refers to ad clicks and views as
<em>attribution sources</em>. To register an ad click or ad view, call
<code translate="no" dir="ltr">registerAttributionSource()</code>. This API expects the following parameters:</p>

<ul>
<li><strong>Attribution source URI:</strong> The platform issues a request to this URI in order
to fetch metadata associated with the attribution source.</li>
<li><strong>Input event:</strong> Either an <a href="/reference/android/view/InputEvent"><code translate="no" dir="ltr">InputEvent</code></a>
object (for a click event) or <code translate="no" dir="ltr">null</code> (for a view event).</li>
</ul>

<p>When the API makes a request to the Attribution Source URI, the ad tech platform
should respond with the attribution source metadata in a new HTTP header
<code translate="no" dir="ltr">Attribution-Reporting-Register-Source</code>, with the following fields:</p>

<ul>
<li><strong>Source event ID:</strong> A DOMString that encodes a 64-bit unsigned integer. This
value represents the event-level data associated with this attribution source
(ad click or view).</li>
<li><strong>Destination:</strong> An origin whose eTLD+1 or app package name where the trigger
event happens.</li>
<li><strong>Expiry (optional):</strong> Expiry, in seconds, for when the source should be
deleted off the device. Default is 30 days, with a minimum value of 2 days and a
maximum value of 30 days. This is rounded to the nearest day.</li>
<li><p><strong>Source priority (optional):</strong> A signed 64-bit integer used to select which
attribution source a given trigger should be associated with, in case multiple
attribution sources could be associated with the trigger.</p>

<p>When a trigger is received, the API finds the matching attribution source
with the highest source priority value and generates a report. Each ad tech
platform can define its own prioritization strategy.</p>

<p>A higher value indicates a higher priority.</p></li>
<li><p><strong>Install and post-install attribution windows (optional):</strong> Used to determine
attribution for <a href="#post-install-attribution">post-install events</a>, described
later in this document.</p></li>
</ul>

<p>The attribution source metadata response may include additional data in the
following separate headers:</p>

<ul>
<li><strong>Aggregation keys (optional):</strong> Specify
<a href="#aggregatable-reports-register-source-data">segmentation</a> to be used for
<a href="#aggregatable-reports">aggregatable reports</a>.</li>
<li><strong>Attribution reporting redirects (optional):</strong> Redirect URLs, to
<a href="#allow-multiple-ad-tech-platforms-register-request">allow multiple ad tech platforms to register a
request</a>.</li>
</ul>

<p>The following snippet shows the current design for attribution source data:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Register-Source: {
  "source_event_id": "[64 bit unsigned integer]",
  "destination": "[eTLD+1 or app package name]",
  "expiry": "[64 bit signed integer]",
  "source_priority": "[64 bit signed integer]"
}
Attribution-Reporting-Register-Aggregate-Source: &lt;aggregation-key-data&gt;
Attribution-Reporting-Redirects: "https://adtechpartner.example"
</code></pre>
<p>The following steps show an example workflow:</p>

<ol>
<li><p>The ad tech SDK calls the API to initiate attribution source registration:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">registerAttributionSource(
    Uri.parse("https://adtech.example/attribution_source?my_ad_click_id=123"),
    myClickEvent);
</code></pre></li>
<li><p>The API makes a request to
<code translate="no" dir="ltr">https://adtech.example/attribution_source?my_ad_click_id=123</code>, using this
header:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Source-Info: navigation
</code></pre></li>
<li><p>This ad tech platform's HTTPS server replies with headers containing the
following:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Register-Source: {
    "destination": "android-app://com.advertiser.example",
    "source_event_id": "234",
    "expiry": "60000",
    "source_priority": "5"
}
Attribution-Reporting-Redirects: https://adtechpartner.example?their_ad_click_id=567
Attribution-Reporting-Source-Info: navigation
</code></pre></li>
<li><p>The API makes a request to each URL specified in
<code translate="no" dir="ltr">Attribution-Reporting-Redirects</code>. In this example, only one URL is specified,
so the API makes a request to <code translate="no" dir="ltr">https://adtechpartner.example?their_ad_click_id=567</code>.</p></li>
<li><p>This ad tech platform's HTTPS server replies with headers containing the
following:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Register-Source: {
    "destination": "android-app://com.advertiser.example",
    "source_event_id": "789",
    "expiry": "120000",
    "source_priority": "2"
}
</code></pre></li>
</ol>

<p>Two navigation (click) attribution sources are registered based on the requests
shown in the previous steps.</p>

<h2 id="register-trigger" data-text="Register a trigger (conversion)">Register a trigger (conversion)</h2>

<p>Ad tech platforms can register <em>triggers</em>—conversions such as installs or
post-install events—using the <code translate="no" dir="ltr">triggerAttribution()</code> method.</p>

<p>The <code translate="no" dir="ltr">triggerAttribution()</code> method expects the <strong>Trigger URI</strong> parameter. The API
issues a request to this URI to fetch metadata associated with the trigger.</p>

<p>The API follows redirects. The ad tech server response should include an HTTP
header called <code translate="no" dir="ltr">Attribution-Reporting-Register-Event-Trigger</code>, which represents
information on one or more registered triggers. The header's content should be
<a href="https://datatracker.ietf.org/doc/html/draft-reschke-http-jfv#section-2">JSON-encoded</a> 
and include the following fields:</p>

<ul>
<li><strong>Trigger data:</strong> Data to identify the trigger event (3 bits for clicks, 1 bit
for views)</li>
<li><strong>Trigger priority (optional):</strong> Signed 64-bit integer which represents the
priority of this trigger compared to other triggers for the same attribution
source</li>
<li><strong>Deduplication key (optional):</strong> Signed 64-bit integer which is used to
identify cases where the same trigger is registered multiple times by the same
ad tech platform, for the same attribution source</li>
</ul>

<p>The ad tech server response may include additional data in the following
headers:</p>

<ul>
<li><strong>Aggregation keys (optional):</strong> A <a href="#aggregatable-reports-register-trigger">list of dictionaries which specifies
aggregation keys</a> and which aggregatable
reports should have their value aggregated.</li>
<li><strong>Aggregation values (optional):</strong> A list of amounts of value which contribute
to each key.</li>
<li><strong>Attribution Reporting Redirects (optional):</strong> Redirect URLs, to
<a href="#allow-multiple-ad-tech-platforms-register-request">allow multiple ad tech platforms to register a
request</a>.</li>
</ul>



<p>Multiple ad tech platforms can register the same trigger event using either
redirects in the <code translate="no" dir="ltr">Attribution-Reporting-Redirects</code> field or multiple calls to
the <code translate="no" dir="ltr">triggerAttribution()</code> method. We recommend that you use the
<strong>deduplication key</strong> field to avoid including duplicate triggers in reports in
the case that the same ad tech platform provides multiple responses for the same
trigger event.</p>

<p>The following snippet shows the current design for trigger data:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Register-Event-Trigger: {
    "trigger_data": "[unsigned 64-bit integer]",
    "trigger_priority": "[signed 64-bit integer]",
    "deduplication_key": "[signed 64-bit integer]"
}
Attribution-Reporting-Aggregate-Trigger-Data: &lt;aggregation-key-data&gt;
Attribution-Reporting-Aggregate-Values: &lt;aggregation-value-data&gt;
Attribution-Reporting-Redirects: "https://adtechpartner.example"
</code></pre>
<p>The following steps show an example workflow:</p>

<ol>
<li><p>The Ad tech SDK calls the API to initiate trigger registration:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">triggerAttribution(
    Uri.parse("https://adtech.example/attribution_trigger?app_install=123"));
</code></pre></li>
<li><p>The API makes a request to <code translate="no" dir="ltr">https://adtech.example/attribution_trigger?app_install=123</code>.</p></li>
<li><p>This ad tech platform's HTTPS server replies with headers containing the
following:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Register-Event-Trigger: {
    "trigger_data": "1122",
    "trigger_priority": "3",
    "deduplication_key": "3344",
}
Attribution-Reporting-Redirects: https://adtechpartner.example?app_install=567
</code></pre></li>
<li><p>The API makes a request to each URL specified in
<code translate="no" dir="ltr">Attribution-Reporting-Redirects</code>. In this example, only one URL is specified,
so the API makes a request to <code translate="no" dir="ltr">https://adtechpartner.example?app_install=567</code>.</p></li>
<li><p>This ad tech platform's HTTPS server replies with headers containing the
following:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Register-Event-Trigger: {
    "trigger_data": "5566",
    "trigger_priority": "3",
    "deduplication_key": "3344"
}
</code></pre>
<p>Two triggers are registered based on the requests in the previous steps.</p></li>
</ol>

<h3 id="source-prioritized-attribution-algorithm" data-text="Source-prioritized attribution algorithm applied">Source-prioritized attribution algorithm applied</h3>

<p>The Attribution Reporting API employs a
<em>source-prioritized attribution algorithm</em> to match a trigger (conversion) to an
attribution source. In the case where
<a href="#allow-multiple-ad-tech-platforms-register-request">multiple ad tech platforms register an attribution
source</a>, as described later
in this document, this attribution
happens independently for each ad tech platform. For each ad tech platform, the
attribution source with the highest priority is attributed with the trigger
event. If there are multiple attribution sources with the same priority, the API
picks the last registered attribution source. Any other attribution sources,
that aren't picked are discarded and are no longer eligible for future trigger
attribution.</p>

<h3 id="post-install-attribution" data-text="Post-install attribution">Post-install attribution</h3>

<p>In some cases, there is a need for post-install triggers to be attributed to the
same attribution source that drove the install, even if there are other eligible
attribution sources that occurred more recently.</p>

<p>The API can support this use case by allowing ad tech platforms to set a
post-install attribution period:</p>

<ul>
<li>When registering an attribution source, specify an install attribution window
during which installs are expected (generally 2-7 days).</li>
<li>When registering an attribution source, specify a post-install attribution
window where any post-install trigger events should be associated with the
attribution source that drove the install (generally 7-30 days).</li>
<li>The Attribution Reporting API validates when an app install happens and
internally attribute the install to the source-prioritized attribution source.
However, the install isn't sent to ad tech platforms and doesn't count against
the platforms' respective rate limits.</li>
<li><p>Any future triggers that happen within the post-install attribution window are
attributed to the same attribution source as the validated install, as long as
that attribution source is eligible.</p>

<p>We are looking into ways to support use cases where the user uninstalls and
reinstalls the app.</p></li>
</ul>

<p>In the future, we might explore extending the design to support more advanced attribution models.</p>

<h3 id="app-web-based-trigger-paths" data-text="All combinations of app- and web-based trigger paths are supported">All combinations of app- and web-based trigger paths are supported</h3>

<p>The Attribution Reporting API enables attribution of the following trigger paths
on a single Android device:</p>

<ul>
<li><strong>App-to-app:</strong> The user sees an ad in an app, then converts in either that
app or another installed app.</li>
<li><strong>App-to-web:</strong> The user sees an ad in an app, then converts in a mobile or
app browser.</li>
<li><strong>Web-to-app:</strong> The user sees an ad in a mobile or app browser, then converts
in an app.</li>
<li><strong>Web-to-web:</strong> The user sees an ad in a mobile or app browser, then converts
in either the same browser or another browser on the same device.</li>
</ul>

<p>We allow web browsers to support new web-exposed functionality, such as
functionality that's similar to the
<a href="https://github.com/WICG/conversion-measurement-api">Privacy Sandbox for the Web's Attribution Reporting
API</a>, which can
call the Android APIs to enable attribution across app and web.</p>

<h3 id="prioritize-multiple-triggers-single-attribution-source" data-text="Prioritize multiple triggers for a single attribution source">Prioritize multiple triggers for a single attribution source</h3>

<p>A single attribution source can lead to multiple triggers. For example, a
purchase flow could involve an "app install" trigger, one or more "add-to-cart"
triggers, and a "purchase" trigger. Each trigger is attributed to one or more
attribution sources according to the
<a href="#source-prioritized-attribution-algorithm">source-prioritized attribution
algorithm</a>, described later in this document.</p>

<p>There are
<a href="#limits-ad-tech-platforms-per-attribution-source">limits on how many triggers can be attributed to a single attribution
source</a>; for more details,
read the section on
<a href="#view-measurement-data">viewing measurement data in attribution reports</a> later
in this document. In
the cases where there are multiple triggers beyond these limits, it's useful to
introduce prioritization logic to get back the most valuable triggers. For
example, the developers of an ad tech platform might want to prioritize getting
"purchase" triggers over "add-to-cart" triggers.</p>

<p>To support this logic, a separate priority field can be set on the
trigger, and the highest priority triggers are picked before limits are applied,
within a given reporting window.</p>



<p>It's common for more than one ad tech platform to receive attribution reports.
Therefore, the API allows multiple ad tech platforms to register the same
attribution source or trigger.</p>



<p>Attribution source redirects are supported in the <code translate="no" dir="ltr">registerAttributionSource()</code>
method:</p>

<ol>
<li>The ad tech platform that calls the <code translate="no" dir="ltr">registerAttributionSource()</code> method
can provide an additional <code translate="no" dir="ltr">Attribution-Reporting-Redirects</code> field in their
response, which represents the set of partner ad tech's redirect URLs.</li>
<li>The API
then calls the redirect URLs so the attribution source can be registered by the
partner ad tech platforms.</li>
</ol>

<p>Multiple partner ad tech platform URLs can be listed in the
<code translate="no" dir="ltr">Attribution-Reporting-Redirects</code> field, and partner ad tech platforms cannot
specify their own <code translate="no" dir="ltr">Attribution-Reporting-Redirects</code> field.</p>

<p>The API also allows different ad tech platforms to each call
<code translate="no" dir="ltr">registerAttributionSource()</code>.</p>



<p>For trigger registration, third parties are supported in a similar way: ad tech
platforms can either use the additional <code translate="no" dir="ltr">Attribution-Reporting-Redirects</code> field,
or they can each call the <code translate="no" dir="ltr">triggerAttribution()</code> method.</p>

<p>When an advertiser uses multiple ad tech platforms to register the same trigger
event, a <em>deduplication key</em> should be used. The deduplication key serves to
disambiguate these repeated reports of the same event. If no deduplication key
is provided, duplicate triggers may be reported back to each ad tech platform as
unique.</p>

<h2 id="view-measurement-data" data-text="View measurement data in attribution reports">View measurement data in attribution reports</h2>

<p>The Attribution Reporting API enables the following types of reports, described
in more detail later in this document:</p>

<ul>
<li><a href="#event-level-reports"><strong>Event-level reports</strong></a> associate a particular
attribution source (click or view) with limited bits of high-fidelity trigger
data.</li>
<li><a href="#aggregatable-reports"><strong>Aggregatable reports</strong></a> aren't necessarily tied with
a specific attribution source. These reports provide richer, higher-fidelity
trigger data than event-level reports, but this data is only available in an
aggregate form.</li>
</ul>

<p>These two report types are complementary to each other and can be used
simultaneously.</p>

<h3 id="event-level-reports" data-text="Event-level reports">Event-level reports</h3>

<p>After a trigger is attributed to an attribution source, an event-level report is
generated and stored on the device until it can be sent back to each ad tech
platform's postback URL during one of the
<a href="#specific-time-windows-sending-reports">time windows for sending reports</a>,
described in more detail later in this document.</p>

<p>Event-level reports are useful when very little information is needed about the
trigger. Event-level trigger data is limited to 3 bits of trigger data for
clicks—which means that a trigger can be assigned one of eight categories—and
1 bit for views. In addition, event-level reports don't support encoding of
high-fidelity trigger-side data, such as a specific price or trigger time.</p>

<p>The event-level report contains data such as the following:</p>

<ul>
<li><strong>Destination:</strong> Advertiser app package name or eTLD+1 where the trigger
happened</li>
<li><strong>Attribution Source ID:</strong> The same attribution source ID that was used for
<a href="#register-attribution-source">registering an attribution source</a></li>
<li><strong>Trigger type:</strong> 1 or 3 bits of low-fidelity trigger data, depending on the
type of attribution source</li>
</ul>

<h3 id="privacy-preserving-mechanisms-event-level-reports" data-text="Privacy-preserving mechanisms applied to event-level reports">Privacy-preserving mechanisms applied to event-level reports</h3>

<h4 id="limited-fidelity-trigger-data" data-text="Limited fidelity of trigger data">Limited fidelity of trigger data</h4>

<p>The API provides 1 bit for view-through triggers and 3 bits for click-through
triggers. Attribution sources continue to support the full 64 bits of metadata.</p>

<p>You should evaluate if and how to reduce the information expressed in
triggers so they work with the limited number of bits available in event-level
reports.</p>

<h4 id="framework-differential-privacy-noise" data-text="Framework for differential privacy noise">Framework for differential privacy noise</h4>

<p>A goal of this API is to allow event-level measurement to satisfy local
differential privacy requirements by using k-randomized responses to generate a
noisy output for each source event.</p>

<p>Noise is applied on whether an attribution source event is reported truthfully.
An attribution source is registered on the device with probability $ p $
that the attribution source is registered as normal, and with probability
$ 1-p $ that the device randomly chooses among all possible output states of the
API (including not reporting anything at all, or reporting multiple fake
reports).</p>

<p>The k-randomized response is an algorithm that is <em>epsilon differentially
private</em> if the following equation is satisfied:</p>

<p>
\[
p = \frac{k}{k + e^ε - 1}
\]
</p>

<p>For low values of ε, the true output is protected by the k-randomized
response mechanism. Exact noise parameters are works in progress and are subject
to change based on feedback.</p>

<h4 id="limits-available-triggers" data-text="Limits on available triggers (conversions)">Limits on available triggers (conversions)</h4>

<p>There are limits on the number of triggers per attribution source, with a
current proposal of the following:</p>

<ul>
<li>1-2 triggers for view ad attribution sources</li>
<li>3 triggers for click ad attribution sources</li>
</ul>

<p>These limits are applied after priorities regarding attribution sources and
triggers are taken into consideration.</p>



<p>There are limits on the number of ad tech platforms that can be associated with
a single attribution source. These limits are applied after priorities regarding
attribution sources and triggers are taken into consideration.</p>

<h4 id="specific-time-windows-sending-reports" data-text="Specific time windows for sending reports">Specific time windows for sending reports</h4>

<p>Reports for ad view attribution sources are sent 1 hour after the source expires.
This expiry date can be configured, but it cannot be fewer than 2 days or more
than 30 days.</p>

<p>Reports for ad click attribution sources cannot be configured and are sent
before the source expires, at specified points in time relative to when the
source was registered. The time between the attribution source and expiry is
split into multiple reporting windows. Each reporting window has a deadline
(from the attribution source time). At the end of each reporting window, the
device collects all the triggers that have occurred since the previous reporting
window and sends a scheduled report. The API supports the following reporting
windows:</p>

<ul>
<li><strong>2 days:</strong> The device collects all the triggers that occurred at most 2 days
after the attribution source was registered. The report is sent 2 days and
1 hour after the attribution source is registered.</li>
<li><strong>7 days:</strong> The device collects all the triggers that occurred more than
2 days but no more than 7 days after the attribution source was registered. The
report is sent 7 days and 1 hour after the attribution source is registered.</li>
<li><strong>A custom length of time,</strong> defined by the "expiry" attribute of an
attribution source. The report is sent 1 hour after the specified expiry time.
This value cannot be fewer than 2 days or more than 30 days.</li>
</ul>

<h3 id="aggregatable-reports" data-text="Aggregatable reports">Aggregatable reports</h3>

<p>Aggregatable reports provide higher-fidelity trigger data from the device more
quickly, beyond what is offered for <a href="#event-level-reports">event-level reports</a>.
This higher-fidelity data can only be learned in <em>aggregate</em>, and isn't
associated with a particular trigger or user. Aggregation keys are up to
128 bits, and this allows aggregatable reports to support reporting use cases
such as the following:</p>

<ul>
<li>Reports for trigger values, such as revenue</li>
<li>Handling more trigger types</li>
</ul>

<p>In addition, aggregatable reports have the following characteristics:</p>

<ul>
<li>An attribution window of 30 days</li>
<li>The same
<a href="#source-prioritized-attribution-algorithm">source-prioritized attribution
logic</a> as the event-level API,
described earlier in this document</li>
</ul>

<p>The overall design of how the Attribution Reporting API prepares and sends
aggregatable reports, shown in figure 1, is as follows:</p>

<ol>
<li>The device sends encrypted aggregatable reports to the ad tech platform.</li>
<li>The ad tech platform sends a batch of aggregatable reports to the aggregation
service for aggregation.</li>
<li>The aggregation service reads a batch of aggregatable reports, decrypts and
aggregates them.</li>
<li>The final aggregates are sent back to the ad tech platform.</li>
</ol>

<figure>
  <img src="/images/design-for-safety/ads/aggregatable-report-design.svg" alt="" width="800">
  <figcaption><b>Figure 1.</b> Process that the Attribution Reporting API uses
  to prepare and send aggregatable reports.</figcaption>
</figure>

<p>Aggregatable reports contain the following data related to attribution sources:</p>

<ul>
<li><strong>Source:</strong> The app's package name or eTLD+1 web URL where the ad was served.</li>
<li><strong>Destination:</strong> The app's package name or eTLD+1 web URL where the trigger
happened.</li>
<li><strong>Date:</strong> The date when the event represented by the attribution source
occurred.</li>
<li><strong>Payload:</strong> Trigger values, collected as encrypted key/value pairs, which is
used in the trusted <a href="#aggregation-service">aggregation service</a> to compute
aggregations.</li>
</ul>

<h4 id="aggregation-services" data-text="Aggregation services">Aggregation services</h4>

<p>The following services provide aggregation functionality and help protect
against inappropriate access of aggregation data.</p>

<p>These services are managed by different parties, which are described in more
detail later in this document:</p>

<ul>
<li>The aggregation service is the only one that ad tech platforms are expected to
deploy.</li>
<li>The
<a href="#key-management-service">key management</a> and
<a href="#privacy-budget-service">privacy budget</a> services are run by trusted parties
called <em>verifiers</em>. These verifiers attest that the code running the aggregation
service is the publicly-available code provided by Google and that
all aggregation service users have the same key and budget services applied to
them.</li>
</ul>

<h5 id="aggregation-service" data-text="Aggregation service">Aggregation service</h5>

<p>Ad tech platforms must, in advance, deploy an <em>aggregation service</em> that's
based on binaries provided by Google.</p>

<p>This aggregation service operates in a Trusted Execution Environment (TEE)
hosted in the cloud. A TEE offers the following security benefits:</p>

<ul>
<li>It ensures that the code operating in the TEE is the specific binary offered
by Google. Unless this condition is satisfied, the aggregation
service can't access the decryption keys it needs to operate.</li>
<li>It offers security around the running process, isolating it from external
monitoring or tampering.</li>
</ul>

<p>These security benefits make it safer for an aggregation service to perform
sensitive operations, such as accessing encrypted data.</p>

<p>For more information on the design, workflow, and security considerations of the
aggregation service, see the
<a href="https://github.com/WICG/conversion-measurement-api/blob/main/AGGREGATION_SERVICE_TEE.md">aggregation service document</a> 
on GitHub.</p>

<h5 id="key-management-service" data-text="Key management service">Key management service</h5>

<p>This service verifies that an aggregation service is running an approved version
of the binary and then provides the aggregation service in the ad tech platform
with the correct decryption keys for their trigger data.</p>

<h5 id="privacy-budget-service" data-text="Privacy budget service">Privacy budget service</h5>

<p>This service tracks how often an ad tech platform's aggregation service accesses
a specific trigger—which can contain multiple aggregation keys—and limits access
to the appropriate number of decryptions. One decryption per trigger is
permitted.</p>

<h3 id="aggregatable-reports-api" data-text="Aggregatable Reports API">Aggregatable Reports API</h3>

<p>The API for creating contributions to aggregatable reports uses the same base
API as when <a href="#register-attribution-source">registering an attribution source</a>
for event-level reports. The following sections describe the extensions of the
API.</p>

<h4 id="aggregatable-reports-register-source-data" data-text="Register the aggregatable source data">Register the aggregatable source data</h4>

<p>When the API makes a request to the Attribution Source URI, the ad tech platform
can register a list of aggregation keys by responding with a new HTTP header
<code translate="no" dir="ltr">Attribution-Reporting-Register-Aggregate-Source</code>, with the following fields for
each aggregation key in the list:</p>

<ul>
<li><strong>Source event ID:</strong> A string for the name of the key. Used as a join key to
combine with trigger-side keys to form the final key.</li>
<li><strong>Key piece:</strong> A bitstring value for the key.</li>
<li><strong>Key offset:</strong> An integer value of offset index for combining this key piece
with the trigger-side key piece.</li>
</ul>

<p>The final key is a combination of this piece and the trigger-side pieces, using
the <strong>key offset</strong> field to concatenate the bitstrings. Final keys are
restricted to a maximum of 128 bits; keys longer than this are truncated.</p>

<p>In the following example, an ad tech platform uses the API to collect the
following:</p>

<ul>
<li>Aggregate conversion counts at a campaign level</li>
<li>Aggregate purchase values at a geo level</li>
</ul>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Register-Aggregate-Source:
[{
  // Generates a "101011001" key prefix named "campaignCounts".
  "source_event_id": "campaignCounts",
  "key_piece": "101011001", // User saw ad from campaign 345 (out of 511).
  "key_offset": 0 // The first part of the key
                  // when combined with trigger-side keys.
},
{
  // Generates a "101" key prefix named "geoValue".
  "source_event_id": "geoValue",
  // Source-side geo region = 5 (US) but pad with 0s since the shop operates in
  // ~100 separate countries.
  "key_piece": "0000101",
  "key_offset": 0 // The first part of the key
                  // when combined with trigger-side keys.
}]
</code></pre>
<h4 id="aggregatable-reports-register-trigger" data-text="Register the aggregatable trigger">Register the aggregatable trigger</h4>

<p>Trigger registration includes two additional headers.</p>

<p>The first header is used to register a list of aggregate keys on the trigger
side. The ad tech platform should respond back with the HTTP header
<code translate="no" dir="ltr">Attribution-Reporting-Aggregate-Trigger-Data</code>, with the following fields for
each aggregate key in the list:</p>

<ul>
<li><strong>Key piece:</strong> A bitstring value for the key.</li>
<li><strong>Key offset:</strong> An integer value, used as the offset index when combining the
attribution source key piece with the trigger key piece.</li>
<li><strong>Source keys:</strong> A list of strings with the names of attribution source side
keys that the trigger key should be combined with to form the final keys.</li>
</ul>

<p>The following snippet continues the example from
<a href="#aggregatable-reports-register-source-data">registering aggregate source data in aggregatable
reports</a>:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Aggregate-Trigger-Data:
[
  // Each dictionary independently adds pieces to multiple source keys.
  {
    "key_piece": "10",// Conversion type purchase = 2
    // Combine key piece at offset index 9 with attribution source key piece.
    "key_offset": 9,
    // Apply this suffix to:
    "source_keys": ["campaignCounts"]
  },
  {
    "key_piece": "10101",// Purchase category shirts = 21
    // Combine key piece at offset index 9 with attribution source key piece.
    "key_offset": 7,
    // Apply this suffix to:
    "source_keys": ["geoValue" ]
  }
]
</code></pre>
<p>The second header is used to register a list of values which should contribute
to each key. The ad tech platform should respond back with the HTTP header
<code translate="no" dir="ltr">Attribution-Reporting-Aggregate-Values</code>.</p>

<p>Each trigger can make multiple contributions to the aggregatable reports. The
total amount of contributions to any given attribution source is bound by an
$ L1 $ parameter, which is the maximum sum of contributions (values) across all
aggregate keys for a given attribution source. Exceeding these limits causes
future contributions to silently drop. The initial proposal is to set $ L1 $ to
$ 2^{16} $ (65536). The noise in the aggregation service is scaled in proportion
to this parameter. Given this, it is recommended to appropriately scale the
values reported for a given aggregate key, based on the portion of $ L1 $
privacy budget allocated to it. This approach helps ensure that the aggregate
reports retain the highest possible fidelity when noise is applied. This
mechanism is highly flexible and can support many aggregation strategies.</p>

<p>In the following example, the privacy budget is split equally between
<code translate="no" dir="ltr">campaignCounts</code> and <code translate="no" dir="ltr">geoValue</code> by splitting the $ L1 $ contribution to each:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">Attribution-Reporting-Aggregate-Values:
{
    // Privacy budget for each key is L1 / 2 = 2^15 (32768).
    // Conversion count was 1.
    // Scale the count to use the full budget allocated: 1 * 32768 = 32768.
    "campaignCounts": 32768,

    // Purchase price was $52.
    // Purchase values for the app range from $1 to $1,024 (integers only).
    // Scaling factor applied is 32768 / 1024 = 32.
    // For $52 purchase, scale the value by 32 ($52 * 32 = $1,664).
    "geoValue": 1664
}
</code></pre>
<p>The preceding example generates the following aggregate counts:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">[
  // campaignCounts:
  {
    // The attribution source key piece "101011001" (offset 0)
    // is concatenated with  "10" (offset 9) trigger key piece to form
    // the final key "10101100110" = 1382.
    "key": "1382",
    "value": 32768
  },
  // geoValue:
  {
    // The attribution source key piece "0000101" (offset 0)
    // is concatenated with  "10101" (offset 7) trigger key piece to form
    // the final key "000010110101" = 181.
    "key": "181",
    "value": "1664"
  }
]
</code></pre>
<p>The scaling factors can be inverted in order to obtain the correct values,
modulo noise that is applied:</p>
<pre translate="no" dir="ltr"><code translate="no" dir="ltr">L1 = 65536
trueCampaignCounts = campaignCounts / (L1 / 2)
trueGeoValue = geoValue / (L1 / 2) * 1024
</code></pre>
<h4 id="differential-privacy" data-text="Differential privacy">Differential privacy</h4>

<p>A goal of this API is to have a framework which can support differentially
private aggregate measurement. This can be achieved by adding noise proportional
to the $ L1 $ budget, such as picking noise with the following distribution:</p>

<p>
\[
Laplace(\frac{ε}{L1})
\]
</p>

<h2 id="future-considerations-open-questions" data-text="Future considerations &amp; open questions">Future considerations &amp; open questions</h2>

<p>The Attribution Reporting API is a work in progress. We're also exploring future
potential features, such as non-last-click attribution models and cross-device
measurement use cases.</p>

<p>Additionally, we'd like to seek feedback from the community on a few issues:</p>

<ol>
<li>We plan to
<a href="#allow-multiple-ad-tech-platforms-register-request">allow multiple ad tech platforms to register attribution
sources</a> and triggers to
enable third-party measurement. With our current proposal, only the ad tech
platform originating the API calls can specify a list of third-party ad tech
platforms. To simplify our API design, we could instead allow ad tech platforms
to daisy-chain redirects by specifying only the next ad tech platform.</li>
<li>To
<a href="#app-web-based-trigger-paths">enable app-to-web measurement</a> where the trigger
can happen on either app or web, ad tech platforms need to provide the same
<strong>destination</strong> field in attribution source and trigger registration. We're
evaluating whether it's reasonable to use the web eTLD+1, even if the trigger
happened in the app.</li>
<li>To prevent duplicate trigger reports, in the event that an ad tech platform
registers the same trigger multiple times, we recommend that you
<a href="#deduplication-key">use a deduplication key</a>. We're evaluating whether apps can
pass this deduplication key to all ad tech platforms, including third-party
platforms.</li>
</ol>

    

    
      <devsite-hats-survey hats-id="onAFgYxTD0kxBYCLVTd0Z41p75CM" listnr-id="5207477"></devsite-hats-survey>
    
  </div></div>
                
                </main>
                <footer>

                </footer>
            </div>
            <!--[if !IE]><script>fixScale(document);</script><![endif]-->
        </body>
    </html>
