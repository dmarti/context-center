

<!doctype html>
    <html lang="en-US" id="template-archives" class="base">
        <head>
        
        <script defer data-domain="context.center" src="https://plausible.io/js/plausible.js"></script>
        <link rel="alternate" type="application/rss+xml" title="Context Center RSS" href="https://context.center/rss/" />
    	<link rel="alternate" type="application/atom+xml" title="Context Center Feed" href="https://context.center/feed/" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Privacy Preserving Ad Click Attribution For the Web</title>
        <link rel="original" http-equiv href="https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" />
        
            
                <!-- <link rel="stylesheet" href="https://context.center/assets/css/template-archives.css?v=2097943621" /> -->
                <link rel="stylesheet" href="https://context.center/assets/css/template-archives.css?v=2097943621" id=""></link>

            
        
        
            <link rel="canonical" href="https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" />
            

            <meta property="og:title"
                content="Privacy Preserving Ad Click Attribution For the Web">

            <meta property="og:description"
                content="A typical website is made of numerous components coming from a wide variety of sources.">


            <meta property="og:url"
                content="https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" />

            <meta property="og:site_name" content="Context Center" />

            <meta property="og:locale" content="en_US" />

            <meta name="twitter:site" content="@chronotope" />

            <meta name="twitter:description" content="A typical website is made of numerous components coming from a wide variety of sources." />

            <!-- I prefer the summary_large_image Twitter card for posts. -->
            <meta name="twitter:card" content="summary_large_image" />
            <!-- You, you're the creator. -->
            <meta name="twitter:creator" content="@chronotope" />
            <!-- This property is for the article title, not site title. -->
            <meta name="twitter:title" content="Privacy Preserving Ad Click Attribution For the Web" />

            

            <meta property="og:type" content="website" />

            <script type="application/ld+json">
                {
                    "@context": "http://schema.org",
                    "@type": "WebPage",
                    "url": "https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/",
                    "headline": "Privacy Preserving Ad Click Attribution For the Web",
                    "about": "A typical website is made of numerous components coming from a wide variety of sources.",

                    "image": [
                        
                        
                    ],
                    "isAccessibleForFree": "True",
                    "isPartOf": {
                        "@type": ["CreativeWork", "Product"],
                        "name": "Fight With Tools",
                        "productID": "fightwithtools.dev"
                    },
                    "license": "http://creativecommons.org/licenses/by-sa/4.0/",
                    "archivedAt": "https://context.center/timegate/https:/webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/",
                    "sameAs": "https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/",
                }
            </script>


        
        
        </head>
        <body >
            <div class="wrapper">
                <header>
                    <div class="left">
                        <h1>Archived: Privacy Preserving Ad Click Attribution For the Web</h1>
                        <p>This is a simplified archive of the page at <a href="https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" target="_blank">https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/</a></p>
                    </div>

                            <div id="share-embed">
                                <span>Use this page embed on your own site:</span>
                                <textarea id="html-embed" name="story" rows="8" cols="40">
                                    <script>window.contexterSetup=window.contexterSetup||function(){window.contexterSetupComplete=!0;class ContexterLink extends HTMLAnchorElement{constructor(){super()}connectedCallback(){this.setAttribute("target","_blank")}}customElements.define("contexter-link",ContexterLink,{extends:"a"}),customElements.define("contexter-inner",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__inner"}}),customElements.define("contexter-thumbnail",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__thumbnail"}}),customElements.define("contexter-byline",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__byline"}}),customElements.define("contexter-keywordset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__keywordset"}}),customElements.define("contexter-linkset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__linkset"}}),customElements.define("contexter-meta",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__meta"}}),customElements.define("contexter-summary",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="p-summary entry-summary"}}),customElements.define("contexter-box-head",class extends HTMLElement{constructor(){super()}connectedCallback(){this.className="contexter-box__head"}}),customElements.define("contexter-box-inner",class extends HTMLElement{constructor(){super()}connectedCallback(){}});class ContexterBox extends HTMLElement{constructor(){super(),this.first=!0,this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){if(this.first){this.first=!1;var style=document.createElement("style"),lightDomStyle=(style.innerHTML=`:host {--background: #f5f6f7;--border: darkblue;--blue: #0000ee;--font-color: black;--inner-border: black;font-family: Franklin,Arial,Helvetica,sans-serif;font-size: 14px;background: var(--background);width: 600px;color: var(--font-color);min-height: 90px;display: block;padding: 8px;border: 1px solid var(--border);cursor: pointer;box-sizing: border-box;margin: 6px;contain: content;margin: 6px auto;}// can only select top-level nodes with slotted::slotted(*) {max-width: 100%;display:block;}::slotted([slot=thumbnail]) {max-width: 100%;display:block;}::slotted([slot=header]) {width: 100%;font-size: 1.25rem;font-weight: bold;display:block;margin-bottom: 6px;}::slotted([slot=author]) {max-width: 50%;font-size: 12px;display:inline-block;float: left;}::slotted([slot=time]) {max-width: 50%;font-size: 12px;display:inline-block;float: right;}::slotted([slot=summary]) {width: 100%;margin-top: 6px;padding: 10px 2px;border-top: 1px solid var(--inner-border);font-size: 15px;display:inline-block;margin-bottom: 6px;}contexter-meta {height: auto;margin-bottom: 4px;width: 100%;display: grid;position: relative;min-height: 16px;grid-template-columns: repeat(2, 1fr);}::slotted([slot=keywords]) {width: 80%;padding: 2px 4px;border-top: 1px solid var(--inner-border);font-size: 11px;display: block;float: right;font-style: italic;text-align: right;grid-column: 2/2;grid-row: 1;align-self: end;justify-self: end;}::slotted([slot=keywords]):empty {border-top: 0px solid var(--inner-border);}::slotted([slot=archive-link]) {font-size: 1em;display: inline;}::slotted([slot=archive-link])::after {content: "|";display: inline;color: var(--font-color);text-decoration: none;margin: 0 .5em;}::slotted([slot=read-link]) {font-size: 1em;display: inline;}contexter-linkset {width: 80%;padding: 2px 4px;font-size: 13px;float: left;font-weight: bold;grid-row: 1;grid-column: 1/2;align-self: end;justify-self: start;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {:host {width: 310px;}}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){:host {--background: #354150;--border: #1f2b37;--blue: #55b0ff;--font-color: #ffffff;--inner-border: #787a7c;background: var(--background);border: 1px solid var(--border)}}`,document.createElement("style"));lightDomStyle.innerHTML=`contexter-box {contain: content;}contexter-box .read-link {font-weight: bold;}contexter-box a {color: #0000ee;}contexter-box img {width: 100%;border: 0;padding: 0;margin: 0;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {...}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){contexter-box a {color: #55b0ff;}}`,this.appendChild(lightDomStyle),this.shadow.appendChild(style);const innerContainer=document.createElement("contexter-box-inner"),innerSlotThumbnail=(this.shadow.appendChild(innerContainer),document.createElement("slot")),innerSlotHeader=(innerSlotThumbnail.name="thumbnail",innerContainer.appendChild(innerSlotThumbnail),document.createElement("slot")),innerSlotAuthor=(innerSlotHeader.name="header",innerContainer.appendChild(innerSlotHeader),document.createElement("slot")),innerSlotTime=(innerSlotAuthor.name="author",innerContainer.appendChild(innerSlotAuthor),document.createElement("slot")),innerSlotSummary=(innerSlotTime.name="time",innerContainer.appendChild(innerSlotTime),document.createElement("slot")),metaContainer=(innerSlotSummary.name="summary",innerContainer.appendChild(innerSlotSummary),document.createElement("contexter-meta")),innerSlotInfo=(innerContainer.appendChild(metaContainer),document.createElement("slot")),linkContainer=(innerSlotInfo.name="keywords",metaContainer.appendChild(innerSlotInfo),document.createElement("contexter-linkset")),innerSlotArchiveLink=(metaContainer.appendChild(linkContainer),document.createElement("slot")),innerSlotReadLink=(innerSlotArchiveLink.name="archive-link",linkContainer.appendChild(innerSlotArchiveLink),document.createElement("slot"));innerSlotReadLink.name="read-link",linkContainer.appendChild(innerSlotReadLink),this.className="contexter-box",this.onclick=e=>{if(!e.target.className.includes("read-link")&&!e.target.className.includes("title-link")){const mainLinks=this.querySelectorAll("a.main-link");mainLinks[0].click()}}}}}customElements.define("contexter-box",ContexterBox)},window.contexterSetupComplete||window.contexterSetup();</script><contexter-box class="link-card h-entry hentry" itemscope="" itemtype="https://schema.org/CreativeWork"><contexter-thumbnail class="thumbnail" slot="thumbnail"></contexter-thumbnail><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><a is="contexter-link" href="https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" itemprop="url">Privacy Preserving Ad Click Attribution For the Web</a></contexter-box-head></contexter-box-head><contexter-byline class="p-author author" slot="author"><span class="p-name byline" rel="author" itemprop="author">@johnwilander</span></contexter-byline><time class="dt-published published" slot="time" itemprop="datePublished" datetime="2019-05-22T20:05:22.000Z">4/22/2019</time><contexter-summary class="p-summary entry-summary" itemprop="abstract" slot="summary"><p>A typical website is made of numerous components coming from a wide variety of sources.</p></contexter-summary><contexter-keywordset itemprop="keywords" slot="keywords"><span rel="category tag" class="p-category" itemprop="keywords">Privacy</span></contexter-keywordset><a is="contexter-link" href="https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" class="read-link main-link" itemprop="sameAs" slot="read-link">Read</a><a href="https://context.center/timegate/https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" is="contexter-link" target="_blank" class="read-link archive-link" itemprop="archivedAt" slot="archive-link">Archived</a></contexter-box>
                                </textarea><br />
                                <button onclick="(function(e){ navigator.clipboard.writeText(document.getElementById('html-embed').value); })()">Copy</button>
                            </div>
                            
                            <script>window.contexterSetup=window.contexterSetup||function(){window.contexterSetupComplete=!0;class ContexterLink extends HTMLAnchorElement{constructor(){super()}connectedCallback(){this.setAttribute("target","_blank")}}customElements.define("contexter-link",ContexterLink,{extends:"a"}),customElements.define("contexter-inner",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__inner"}}),customElements.define("contexter-thumbnail",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__thumbnail"}}),customElements.define("contexter-byline",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__byline"}}),customElements.define("contexter-keywordset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__keywordset"}}),customElements.define("contexter-linkset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__linkset"}}),customElements.define("contexter-meta",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__meta"}}),customElements.define("contexter-summary",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="p-summary entry-summary"}}),customElements.define("contexter-box-head",class extends HTMLElement{constructor(){super()}connectedCallback(){this.className="contexter-box__head"}}),customElements.define("contexter-box-inner",class extends HTMLElement{constructor(){super()}connectedCallback(){}});class ContexterBox extends HTMLElement{constructor(){super(),this.first=!0,this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){if(this.first){this.first=!1;var style=document.createElement("style"),lightDomStyle=(style.innerHTML=`:host {--background: #f5f6f7;--border: darkblue;--blue: #0000ee;--font-color: black;--inner-border: black;font-family: Franklin,Arial,Helvetica,sans-serif;font-size: 14px;background: var(--background);width: 600px;color: var(--font-color);min-height: 90px;display: block;padding: 8px;border: 1px solid var(--border);cursor: pointer;box-sizing: border-box;margin: 6px;contain: content;margin: 6px auto;}// can only select top-level nodes with slotted::slotted(*) {max-width: 100%;display:block;}::slotted([slot=thumbnail]) {max-width: 100%;display:block;}::slotted([slot=header]) {width: 100%;font-size: 1.25rem;font-weight: bold;display:block;margin-bottom: 6px;}::slotted([slot=author]) {max-width: 50%;font-size: 12px;display:inline-block;float: left;}::slotted([slot=time]) {max-width: 50%;font-size: 12px;display:inline-block;float: right;}::slotted([slot=summary]) {width: 100%;margin-top: 6px;padding: 10px 2px;border-top: 1px solid var(--inner-border);font-size: 15px;display:inline-block;margin-bottom: 6px;}contexter-meta {height: auto;margin-bottom: 4px;width: 100%;display: grid;position: relative;min-height: 16px;grid-template-columns: repeat(2, 1fr);}::slotted([slot=keywords]) {width: 80%;padding: 2px 4px;border-top: 1px solid var(--inner-border);font-size: 11px;display: block;float: right;font-style: italic;text-align: right;grid-column: 2/2;grid-row: 1;align-self: end;justify-self: end;}::slotted([slot=keywords]):empty {border-top: 0px solid var(--inner-border);}::slotted([slot=archive-link]) {font-size: 1em;display: inline;}::slotted([slot=archive-link])::after {content: "|";display: inline;color: var(--font-color);text-decoration: none;margin: 0 .5em;}::slotted([slot=read-link]) {font-size: 1em;display: inline;}contexter-linkset {width: 80%;padding: 2px 4px;font-size: 13px;float: left;font-weight: bold;grid-row: 1;grid-column: 1/2;align-self: end;justify-self: start;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {:host {width: 310px;}}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){:host {--background: #354150;--border: #1f2b37;--blue: #55b0ff;--font-color: #ffffff;--inner-border: #787a7c;background: var(--background);border: 1px solid var(--border)}}`,document.createElement("style"));lightDomStyle.innerHTML=`contexter-box {contain: content;}contexter-box .read-link {font-weight: bold;}contexter-box a {color: #0000ee;}contexter-box img {width: 100%;border: 0;padding: 0;margin: 0;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {...}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){contexter-box a {color: #55b0ff;}}`,this.appendChild(lightDomStyle),this.shadow.appendChild(style);const innerContainer=document.createElement("contexter-box-inner"),innerSlotThumbnail=(this.shadow.appendChild(innerContainer),document.createElement("slot")),innerSlotHeader=(innerSlotThumbnail.name="thumbnail",innerContainer.appendChild(innerSlotThumbnail),document.createElement("slot")),innerSlotAuthor=(innerSlotHeader.name="header",innerContainer.appendChild(innerSlotHeader),document.createElement("slot")),innerSlotTime=(innerSlotAuthor.name="author",innerContainer.appendChild(innerSlotAuthor),document.createElement("slot")),innerSlotSummary=(innerSlotTime.name="time",innerContainer.appendChild(innerSlotTime),document.createElement("slot")),metaContainer=(innerSlotSummary.name="summary",innerContainer.appendChild(innerSlotSummary),document.createElement("contexter-meta")),innerSlotInfo=(innerContainer.appendChild(metaContainer),document.createElement("slot")),linkContainer=(innerSlotInfo.name="keywords",metaContainer.appendChild(innerSlotInfo),document.createElement("contexter-linkset")),innerSlotArchiveLink=(metaContainer.appendChild(linkContainer),document.createElement("slot")),innerSlotReadLink=(innerSlotArchiveLink.name="archive-link",linkContainer.appendChild(innerSlotArchiveLink),document.createElement("slot"));innerSlotReadLink.name="read-link",linkContainer.appendChild(innerSlotReadLink),this.className="contexter-box",this.onclick=e=>{if(!e.target.className.includes("read-link")&&!e.target.className.includes("title-link")){const mainLinks=this.querySelectorAll("a.main-link");mainLinks[0].click()}}}}}customElements.define("contexter-box",ContexterBox)},window.contexterSetupComplete||window.contexterSetup();</script><contexter-box class="link-card h-entry hentry" itemscope="" itemtype="https://schema.org/CreativeWork"><contexter-thumbnail class="thumbnail" slot="thumbnail"></contexter-thumbnail><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><a is="contexter-link" href="https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" itemprop="url">Privacy Preserving Ad Click Attribution For the Web</a></contexter-box-head></contexter-box-head><contexter-byline class="p-author author" slot="author"><span class="p-name byline" rel="author" itemprop="author">@johnwilander</span></contexter-byline><time class="dt-published published" slot="time" itemprop="datePublished" datetime="2019-05-22T20:05:22.000Z">4/22/2019</time><contexter-summary class="p-summary entry-summary" itemprop="abstract" slot="summary"><p>A typical website is made of numerous components coming from a wide variety of sources.</p></contexter-summary><contexter-keywordset itemprop="keywords" slot="keywords"><span rel="category tag" class="p-category" itemprop="keywords">Privacy</span></contexter-keywordset><a is="contexter-link" href="https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" class="read-link main-link" itemprop="sameAs" slot="read-link">Read</a><a href="https://context.center/timegate/https://webkit.org/blog/8943/privacy-preserving-ad-click-attribution-for-the-web/" is="contexter-link" target="_blank" class="read-link archive-link" itemprop="archivedAt" slot="archive-link">Archived</a></contexter-box>
                            


                </header>
                <main>
                
                    <div id="readability-page-1" class="page"><article id="post-8943">
            
            

            <div>
                                
                <p><img width="3072" height="3072" src="https://webkit.org/wp-content/uploads/store-ad-clicks-hero.png" alt="" srcset="https://webkit.org/wp-content/uploads/store-ad-clicks-hero.png 3072w, https://webkit.org/wp-content/uploads/store-ad-clicks-hero-150x150.png 150w, https://webkit.org/wp-content/uploads/store-ad-clicks-hero-300x300.png 300w, https://webkit.org/wp-content/uploads/store-ad-clicks-hero-768x768.png 768w, https://webkit.org/wp-content/uploads/store-ad-clicks-hero-1024x1024.png 1024w" sizes="(max-width: 3072px) 100vw, 3072px"></p>
<p>A typical website is made of numerous components coming from a wide variety of sources. Many of the sources that make up a website are opaque to the user, and some third-party resources are designed to identify and track users as they browse the web, often in order to retarget ads and measure ad campaign effectiveness.</p>
<p>The combination of third-party web tracking and ad campaign measurement has led many to conflate web privacy with a web free of advertisements. We think that’s a misunderstanding. Online ads and measurement of their effectiveness do not require Site A, where you clicked an ad, to learn that you purchased something on Site B. The only data needed for measurement is that <em>someone</em> who clicked an ad on Site A made a purchase on Site B.</p>
<p>Today we are presenting a new technology to allow attribution of ad clicks on the web while preserving user privacy. We used the following principles as we designed this technology:</p>
<ul>
<li><strong>Users should not be uniquely identified across websites for the purposes of ad click attribution</strong>. This means the combined data of an ad click and a conversion should not be attributable to a single user at web scale. To achieve this, our design has the following properties:
<ul>
<li>Up to 64 ad campaigns can be measured in parallel per website where ads are placed by an advertiser. This low number means ad campaign IDs cannot be turned into user identifiers.</li>
<li>Up to 64 conversion events can be distinguished on the advertiser’s own website. This means conversion IDs are also restricted from being turned into user identifiers.</li>
</ul>
</li>
<li><strong>Only websites that users visit should be involved in measuring ad clicks and conversions</strong>. This means that opaque third-parties should not receive ad click attribution reports and we enforce it by requiring that the ad link is part of a first-party webpage and by only reporting on which first-party website a conversion happened.</li>
<li><strong>The browser should act on behalf of the user and do its best to preserve privacy while reporting on ad click attribution</strong>. We achieve this by:
<ul>
<li>Sending attribution reports in a dedicated Private Browsing Mode even though the user is in regular browsing mode.</li>
<li>Disallowing data like cookies for reporting purposes.</li>
<li>Delaying reports randomly between 24 and 48 hours.</li>
<li>Not supporting Privacy Preserving Ad Click Attribution at all when the user is in Private Browsing Mode.</li>
</ul>
</li>
<li><strong>The browser vendor should not learn about the user’s ad clicks or conversions</strong>. For this reason, we designed the feature to do all of its work on-device. The browser vendor does not see any of the ad click attribution data.</li>
</ul>
<p>Critically, our solution avoids placing trust in any of the parties involved — the ad network, the merchant, or any other intermediaries — and dramatically limits the entropy of data passed between them to prevent communication of a tracking identifier.</p>
<h2>Ad Click Attribution in a Nutshell</h2>
<p>Here’s a simple example of ad click attribution:<br>
An online store runs an ad on a search engine website. If a user clicks the ad and eventually buys something, both the online store and the search engine website where the ad was placed want to know; they want the purchase to be <em>attributed</em> to the ad click so that the store knows where to focus their advertising budget. Such attribution is used for measurement of which ads are effective.</p>
<h2>Traditional, Privacy-Invasive Ad Click Attribution</h2>
<p>Traditionally, ad click attribution has been done through the use of cookies and so-called “tracking pixels.” Here’s an illustration of how this works:</p>
<figure><img loading="lazy" width="2916" height="996" src="https://webkit.org/wp-content/uploads/privacy-invading-ad-click-attribution.png" alt="Privacy invading ad click attribution" srcset="https://webkit.org/wp-content/uploads/privacy-invading-ad-click-attribution.png 2916w, https://webkit.org/wp-content/uploads/privacy-invading-ad-click-attribution-300x102.png 300w, https://webkit.org/wp-content/uploads/privacy-invading-ad-click-attribution-768x262.png 768w, https://webkit.org/wp-content/uploads/privacy-invading-ad-click-attribution-1024x350.png 1024w" sizes="(max-width: 2916px) 100vw, 2916px"></figure>
<p>The illustration above shows the user John:</p>
<ol>
<li>Searching for “grill” on search.example, </li>
<li>Clicking an ad which takes him to shop.example, and </li>
<li>Finally adding a $90 grill to a shopping cart.</li>
</ol>
<p>Following each action on shop.example, shop.example fires a tracking pixel (a request for an invisible image) to search.example to report progress toward a purchase.</p>
<p>In browsers without appropriate privacy protections, search.example will identify John through his cookies every time shop.example fires such a tracking pixel to search.example. This pervasive technology allows search.example to learn everything John does on shop.example and all other websites that fire similar tracking pixels. Even worse, all these pixels fire regardless of whether John has clicked an ad or not.</p>
<p>Needless to say, tracking pixels that carry cookies enable sites such as search.example to build up a huge profile of people’s interests, purchasing power, habits, age, et cetera. We refer to this as cross-site tracking and Safari prevents it from happening through the WebKit feature Intelligent Tracking Prevention (ITP).</p>
<p>As more and more browsers acknowledge the problems of cross-site tracking, we should expect privacy-invasive ad click attribution to become a thing of the past.</p>
<h2>Privacy Preserving Ad Click Attribution</h2>
<p>We propose a modern way of doing ad click attribution that doesn’t allow for cross-site tracking of users but does provide a means of measuring the effectiveness of online ads. It is built into the browser itself and runs on-device which means that the browser vendor does not get to see what ads are clicked or which purchases are made.</p>
<p>Privacy Preserving Ad Click Attribution has three steps:</p>
<ol>
<li>Store ad clicks. This is done by the page hosting the ad at the time of an ad click.</li>
<li>Match conversions against stored ad clicks. This is done on the website the ad navigated to as a result of the click. Conversions do not have to happen right after a click and do not have to happen on the specific landing page, just the same website.</li>
<li>Send out ad click attribution data. This is done by the browser after a conversion matches an ad click.</li>
</ol>
<p>Let’s go through these steps in detail and which steps we’ve taken to preserve the user’s privacy.</p>
<h3>Step 1: Store Ad Clicks</h3>
<p>Anchor elements, often referred to as links, now support two new, optional attributes called adDestination and adCampaignID.</p>
<p>As shown in the illustration below, adDestination is the domain the ad click is navigating the user to, and adCampaignID is the identifier of the ad campaign.</p>
<figure><img loading="lazy" width="2916" height="1092" src="https://webkit.org/wp-content/uploads/store-ad-clicks.png" alt="Store ad clicks" srcset="https://webkit.org/wp-content/uploads/store-ad-clicks.png 2916w, https://webkit.org/wp-content/uploads/store-ad-clicks-300x112.png 300w, https://webkit.org/wp-content/uploads/store-ad-clicks-768x288.png 768w, https://webkit.org/wp-content/uploads/store-ad-clicks-1024x383.png 1024w" sizes="(max-width: 2916px) 100vw, 2916px"></figure>
<p>If the user clicks the ad link on search.example, the browser will follow the navigation, through potential redirects, to make sure that the user actually lands on shop.example. If so, the browser stores the ad click, comprising the following data (presented here in plain English): <em>The user clicked shop.example’s ad campaign 55 on search.example.</em></p>
<p>Here are the important privacy aspects of this step:</p>
<ul>
<li>The link needs to be an element on the first-party website (the main frame), not a link in an iframe. This is to meet user expectations and to be able to provide control to the user. Users can only be expected to understand which first-party website they clicked an ad on and which first-party website they made a purchase on. We also think it’s important that the first-party website that serves the ad is the one attributed for the performance of the ad campaign.</li>
<li>Neither search.example nor shop.example can read the stored ad click data or detect that it exists.</li>
<li>The browser only stores ad clicks for a limited time. In WebKit’s implementation that is seven days.</li>
<li>The entropy of the ad campaign ID needs to be properly restricted to not become a cross-site tracking vector. WebKit’s implementation allows a value between 0 and 63, i.e. a maximum of 64 shop.example ad campaigns running in parallel on search.example.</li>
</ul>
<h3>Step 2: Match Conversions Against Stored Ad Clicks</h3>
<p>To achieve ad click attribution, the browser needs to be able to match <em>conversions</em> with stored ad clicks. What are conversions?</p>
<ul>
<li>Adding an item to the shopping cart is a conversion.</li>
<li>Signing up for a new service is a conversion.</li>
<li>Entering shipping or payment information is a conversion.</li>
<li>Pulling the trigger and actually buying something is a conversion.</li>
</ul>
<p>Matching conversions to ad clicks allows shop.example to understand that a specific ad campaign may be effective in getting customers to add items to their shopping carts but something in the checkout flow throws them off.</p>
<p>How does Privacy Preserving Ad Click Attribution detect a conversion and match it with a stored ad click? It makes use of the legacy tracking pixels!</p>
<figure><img loading="lazy" width="2346" height="1026" src="https://webkit.org/wp-content/uploads/match-conversions-ad-clicks.png" alt="Match conversions ad clicks" srcset="https://webkit.org/wp-content/uploads/match-conversions-ad-clicks.png 2346w, https://webkit.org/wp-content/uploads/match-conversions-ad-clicks-300x131.png 300w, https://webkit.org/wp-content/uploads/match-conversions-ad-clicks-768x336.png 768w, https://webkit.org/wp-content/uploads/match-conversions-ad-clicks-1024x448.png 1024w" sizes="(max-width: 2346px) 100vw, 2346px"></figure>
<p>In the illustration above, an existing request to the existing tracking pixel is redirected by search.example on its own server infrastructure to a well-known location in order to signal to the browser that this is in fact a conversion happening. Note that privacy protections such as ITP will typically make sure that no cookies are sent in this request.</p>
<p>The path parameter “20” at the end of the well-known location is the conversion data. This gives shop.example an opportunity to say something about the conversion such as where in the sales funnel the customer is, what the value of the conversion is, what time of day it is, or whatever they decide is relevant for them.</p>
<p>The redirect to the well-known location may also include an optional priority parameter which indicates the importance of this particular conversion in the case of multiple conversions matching the same stored ad click.</p>
<p>Here are the important privacy aspects of this step:</p>
<ul>
<li>Neither search.example nor shop.example know whether there is any stored ad click data to be matched against.</li>
<li>Neither search.example nor shop.example are told by the browser whether there was a match or not.</li>
<li>The entropy of the ad conversion data needs to be properly restricted to not become a cross-site tracking vector. WebKit’s implementation allows a value between 0 and 63, i.e. six bits to distinguish conversion events. As mentioned earlier, shop.example decides what goes into these bits. For instance, they may spend two bits on monetary value in four buckets: {less than $10, between $10 and $50, between $51 and $200, above $200}.</li>
</ul>
<p>We expect to also implement a JavaScript API to send this information to the .well-known location to remove the requirement for tracking pixels but we’d like to openly discuss what should go into that API since it is much more forward looking than retrofitting existing tracking pixels.</p>
<h3>Step 3: Send Out Ad Click Attribution Data</h3>
<p>Now we come to the third and final step — the browser reports that a conversion happened for a user that had previously clicked an ad.</p>
<figure><img loading="lazy" width="2916" height="1092" src="https://webkit.org/wp-content/uploads/send-ad-click-attribution-data.png" alt="Send Ad Click Attribution Data" srcset="https://webkit.org/wp-content/uploads/send-ad-click-attribution-data.png 2916w, https://webkit.org/wp-content/uploads/send-ad-click-attribution-data-300x112.png 300w, https://webkit.org/wp-content/uploads/send-ad-click-attribution-data-768x288.png 768w, https://webkit.org/wp-content/uploads/send-ad-click-attribution-data-1024x383.png 1024w" sizes="(max-width: 2916px) 100vw, 2916px"></figure>
<p>Once the browser has matched a conversion against a stored ad click, it sets a timer, randomized between 24 and 48 hours. When that timer fires, the browser makes an ephemeral, stateless POST request to the same well-known location. In our example, the request would go to https://search.example/.well-known/ad-click-attribution/20/55, with the referrer request header set to https://shop.example.</p>
<p>In plain English this report would say: <em>24 to 48 hours ago, some user who previously clicked shop.example’s ad campaign 55 on search.example, converted with data 20 on shop.example.</em></p>
<p>Once the ephemeral, stateless POST request goes out, the stored ad click is consumed and cannot be converted further. This is in part why we have the minimum delay of 24 hours. During that delay, shop.example has the opportunity to signal further conversions, for instance down a sales funnel, and only the most important conversion will be sent in the POST request. The importance is controlled through the optional priority parameter in the conversion redirect, as mentioned above.</p>
<p>Here are the important privacy aspects of this step:</p>
<ul>
<li>Neither search.example nor shop.example know that an attribution request has been scheduled.</li>
<li>The 24–48 hour delay makes sure a conversion that happens shortly after an ad click will not allow for speculative profiling of the user by search.example. The randomness in the delay makes sure that the request does not in itself reveal when during the day the conversion happened. If shop.example wants time of day data, they will have to spend some of their six bits of conversion data on it.</li>
<li>The ephemeral, stateless request makes sure the request is not associated with state built up through other browsing. Ephemeral in this sense is referred to as Private Browsing in Safari.</li>
<li>The well-known location allows for a simple rule if Content Blockers wants to block such conversion reporting.</li>
</ul>
<h2>Privacy Considerations</h2>
<p>For ad click attribution to happen, some bits of data about what happened across two websites need to be sent. Today’s practice of ad click attribution has no practical limit on the bits of data, which allows for full cross-site tracking of users using cookies. This is privacy invasive and thus we are obliged to prevent such ad click attribution from happening in Safari and WebKit.</p>
<p>But by keeping the entropy of attribution data low enough, we believe the reporting can be done in a privacy preserving way.</p>
<p>Here is a summary of our privacy considerations for Privacy Preserving Ad Click Attribution:</p>
<ul>
<li>Only links served on first-party pages should be able to store ad click attribution data. This ensures that users have a chance of understanding how Privacy Preserving Ad Click Attribution works.</li>
<li>Neither the website where the ad click happens nor the website where the conversion happens should be able to see whether ad click data has been stored, has been matched, or is scheduled for reporting.</li>
<li>Ad clicks should only be stored for a limited time, such as a week. Users cannot be expected to understand that a purchase they make today is attributed to an ad click they made months ago.</li>
<li>The entropy of both ad campaign ID and conversion data needs to be restricted to a point where this data cannot be repurposed for cross-site tracking of users. We propose six bits each for these two pieces of data, or values between 0 and 63.</li>
<li>Ad click attribution requests should be delayed randomly between 24 to 48 hours. This makes sure that a conversion that happens shortly after an ad click will not allow for speculative cross-site profiling of the user. The randomness in the delay makes sure the request does not in itself reveal when during the day the conversion happened.</li>
<li>The browser should not guarantee any specific order in which multiple ad click attribution requests are sent, since the order itself could be abused to increase the entropy and allow for cross-site tracking of users.</li>
<li>The browser should use an ephemeral session (a.k.a. private or incognito mode) to make ad click attribution requests.</li>
<li>The browser should not use or accept any credentials such as cookies, client certificates, or Basic Authentication in ad click attribution requests or responses.</li>
<li>The browser should offer a way to turn ad click attribution on and off. We intend to have the default setting to be on to encourage websites to move to this technology and abandon general cross-site tracking.</li>
<li>The browser should not enable ad click attribution in private/incognito mode.</li>
</ul>
<h2>Try It Out In Safari Technology Preview!</h2>
<p>We’re happy to offer Privacy Preserving Ad Click Attribution as an experimental feature in Safari Technology Preview 82+.</p>
<p>First, enable the Develop menu, then go to the Experimental Features submenu.</p>
<figure><img loading="lazy" width="1453" height="140" src="https://webkit.org/wp-content/uploads/image.png" alt="" srcset="https://webkit.org/wp-content/uploads/image.png 1453w, https://webkit.org/wp-content/uploads/image-300x29.png 300w, https://webkit.org/wp-content/uploads/image-768x74.png 768w, https://webkit.org/wp-content/uploads/image-1024x99.png 1024w" sizes="(max-width: 1453px) 100vw, 1453px"><img loading="lazy" width="1459" height="137" src="https://webkit.org/wp-content/uploads/experimental-features-dark.png" alt="Experimental Features menu" srcset="https://webkit.org/wp-content/uploads/experimental-features-dark.png 1459w, https://webkit.org/wp-content/uploads/experimental-features-dark-300x28.png 300w, https://webkit.org/wp-content/uploads/experimental-features-dark-768x72.png 768w, https://webkit.org/wp-content/uploads/experimental-features-dark-1024x96.png 1024w" sizes="(max-width: 1459px) 100vw, 1459px"></figure>
<p>There you’ll find “Ad Click Attribution” which enables the feature itself, and “Ad Click Attribution Debug Mode” which enables debug logging for developers and shortens the 24–48 hour delay to a static one minute delay, also for use by developers.</p>
<h3>Debugging the Link Attributes</h3>
<p>A cross-site anchor element that wants to push ad click attribution data into the browser looks like this:<br>
<code>&lt;a href="https://some.site.example" addestination="https://shop.example" adcampaignid="55"&gt;</code></p>
<p>To debug such elements, you use the Web Inspector’s console with the “Preserve Log” setting enabled. Here are a few examples of console warnings you may see if there’s something wrong with your attribution attributes:</p>
<p><code>Both adcampaignid and addestination need to be set for Ad Click Attribution to work.</code></p>
<p><code>Ad Click Attribution is only supported in the main frame.</code></p>
<p>This tells you the anchor element is not part of the main frame.</p>
<p><code>addestination can not be the same site as the current website.</code> This technology is meant for cross-site attribution of ad clicks. There is no need for it within the same website.</p>
<h3>Debugging Storage of Ad Clicks</h3>
<p>For debugging anything beyond the anchor element, you need to use the system log (syslog). Here’s how you achieve that:</p>
<ol>
<li>Enable Ad Click Attribution Debug Mode in the Develop–&gt;Experimental Features submenu.</li>
<li>In your macOS Terminal, run: <code>log stream -info | grep AdClickAttribution</code>.</li>
</ol>
<p>Now if you click a cross-site element with adDestination and adCampaignID attributes, you should expect to see the following in your syslog:<br>
<code>Storing an ad click.</code></p>
<h3>Debugging Conversions</h3>
<p>A conversion is signaled through a same-site HTTP redirect to /.well-known/ad-click-attribution/[a decimal value between 0 and 63 representing the conversion data]. Same-site here means search.example needs to be the server redirecting to https://search.example/.well-known/ad-click-attribution/. The reason for this is that search.example should be in control of when stored ad clicks on its site are consumed. Note that the conversion redirect is done as a subresource on shop.example so we don’t mean same-site as the main frame.</p>
<p>Once you do such a redirect, the syslog might feature one of the following error messages:</p>
<p><code>Conversion was not accepted because the HTTP redirect was not same-site.</code> This is the requirement mentioned above, i.e. it has to be search.example redirecting to search.example/.well-known/ad-click-attribution/.</p>
<p><code>Conversion was not accepted because it was requested in an HTTP redirect that is same-site as the first-party.</code> Again, this technology is meant for cross-site attribution of ad clicks. There is no need for it within the same website.</p>
<p><code>Conversion was not accepted because the URL's protocol is not HTTPS or the URL contains one or more of username, password, query string, and fragment.</code> The request to the well-known location has to be HTTPS and cannot contain a username, password, query string, or fragment.</p>
<p><code>Conversion was not accepted because the URL path did not start with /.well-known/ad-click-attribution/.</code></p>
<p><code>Conversion was not accepted because the conversion data could not be parsed or was higher than the allowed maximum of 63.</code></p>
<p><code>Conversion was not accepted because the URL path contained unrecognized parts.</code> This is a catch-all error message for when the URL has unrecognized path elements or is not of the correct length.</p>
<h3>Detecting Successful Conversions</h3>
<p>If you got everything right in the redirect to the well-known location, you should see the following message in the syslog:<br>
<code>Got a conversion with conversion data: 20 and priority: 0.</code></p>
<p>Here you see the priority parameter. It is a way for the server to signal how important a particular conversion is so that the browser can report the most important one. Take the sales funnel example. There, multiple conversions will happen in succession: add to shopping cart, enter shipping info, enter payment info, and finalize purchase. Most likely, the finalized purchase is the conversion that should be reported together with the ad campaign ID. Priority can be 0 to 63, higher means higher priority, and the priority value is only used for internal bookkeeping, i.e. not sent in any request.</p>
<p>Henceforth, lets assume the redirect is done with conversion data 20 and priority 12, like so:<br>
<code>https://search.example/.well-known/ad-click-attribution/20/12</code></p>
<p>Now, if there’s a stored ad click that matches this conversion, you’ll see detailed conversion information in the syslog:</p>
<p><code>Converted a stored ad click with conversion data: 20 and priority: 12.</code> This is when a previously unconverted ad click is converted.</p>
<p><code>Re-converted an ad click with a new one with conversion data: 20 and priority: 12 because it had higher priority.</code> This is for when there’s a conversion of higher priority that matches an already scheduled conversion request. The ad click is kept, re-converted with the high priority conversion, and scheduled for reporting.</p>
<p><code>Replaced a previously converted ad click with a new one with conversion data: 20 and priority: 12 because it had higher priority.</code> This is for when there is a <em>different</em> ad click (the user may have clicked more than one ad) with a scheduled conversion request but with lower priority. The newly converted ad click with higher priority replaces the old one.</p>
<p>Finally, you’ll see the scheduling of the report request in the syslog:<br>
<code>Setting timer for firing conversion requests to the debug mode timeout of 60 seconds where the regular timeout would have been 111003 seconds.</code> This is special-cased for Ad Click Attribution Debug Mode. Instead of the 24 to 48 hour delay, there’s only a 60 second delay. The log message tells what the real delay would have been, in this case ≈31 hours.</p>
<h3>Receiving Conversion Reports</h3>
<p>When the scheduled timer fires, an HTTP POST request is made to ./well-known/ad-click-attribution/[conversion data]/[ad campaign ID], effectively reporting that a conversion happened for a user that previously clicked an associated advertisement. In our example, this request would go to:<br>
<code>https://search.example/.well-known/ad-click-attribution/20/55</code><br>
… with the referrer request header set to:<br>
<code>https://shop.example/</code></p>
<p>When this request is about to go out, you’ll see the following syslog entry:<br>
<code>About to fire an attribution request for a conversion.</code></p>
<p>If something went wrong with the request, you’ll see it in the syslog:<br>
<code>Received error: [error message] for ad click attribution request.</code></p>
<h2>Where To Send Feedback and Bug Reports</h2>
<p>Privacy Preserving Ad Click Attribution is in the early stage of being <a href="https://wicg.github.io/ad-click-attribution/index.html">proposed as a standard</a> through the W3C Web Platform Incubator Community Group (WICG). Please <a href="https://github.com/WICG/ad-click-attribution/issues/">join the discussion and file issues</a> to discuss how this technology fits with your use cases.</p>
<p>If you find that the experimental feature in Safari Technology Preview doesn’t work as explained, please file a WebKit bug at <a href="https://bugs.webkit.org/">https://bugs.webkit.org</a> and CC John Wilander.</p>
<p>For technical inquiries on Privacy Preserving Ad Click Attribution, you’ll find me on Twitter: <a href="https://twitter.com/johnwilander">@johnwilander</a></p>

                            </div>
        </article></div>
                
                </main>
                <footer>

                </footer>
            </div>
            <!--[if !IE]><script>fixScale(document);</script><![endif]-->
        </body>
    </html>
